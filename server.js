// Generated by CoffeeScript 1.6.3
(function() {
  var MainPageTitle, app, elasticSearchHost, elasticSearchPort, elasticSearchUrl, errorLogger, express, http, indexName, logger;

  MainPageTitle = "Hlavná stránka";

  elasticSearchHost = "ubuntuserver";

  elasticSearchPort = "9200";

  indexName = "wikipedia_cached";

  express = require('express');

  http = require('http');

  app = express();

  elasticSearchUrl = function(title) {
    return ("http://" + elasticSearchHost + ":" + elasticSearchPort + "/" + indexName + "/page/") + encodeURIComponent(title);
  };

  logger = function(req, res, next) {
    console.log('Request: ' + req.method + ' ' + req.url);
    return next();
  };

  errorLogger = function(err, req, res, next) {
    return console.log('Error: ' + req.method + ' ' + req.url + ' ' + err.message);
  };

  app.configure(function() {
    app.use(logger);
    return app.use(app.router);
  });

  app.get('/', function(req, res) {
    return res.redirect('/wiki/' + MainPageTitle);
  });

  app.get('/wiki/:contentId', function(req, res) {
    console.log(elasticSearchUrl(req.params.contentId));
    return http.get(elasticSearchUrl(req.params.contentId), function(innerRes) {
      var body;
      if (innerRes.statusCode !== 200) {
        return res.send(innerRes.statusCode);
      } else {
        body = '';
        innerRes.on('data', function(bodyChunk) {
          return body += bodyChunk;
        });
        return innerRes.on('end', function() {
          return res.send(JSON.parse(body)._source.text);
        });
      }
    });
  });

  app.get('/search/:searchString', function(req, res) {
    return res.send(req.params.searchString);
  });

  app.listen(8080);

}).call(this);
